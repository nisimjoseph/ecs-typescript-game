(()=>{"use strict";var e,t={83(e,t,s){s.d(t,{Dv:()=>Bullet,RP:()=>PowerUp,ai:()=>Player,jK:()=>Enemy,st:()=>Boss});class Player{}class Enemy{}class Bullet{}class PowerUp{}class Boss{}},266(e,t,s){s.d(t,{W:()=>Explosion});class Explosion{constructor(e=100,t=.5,s="#ff6600",n=[]){this.maxRadius=e,this.duration=t,this.color=s,this.particles=n,this.elapsed=0,this.currentRadius=10;for(let e=0;e<12;e++){const t=e/12*Math.PI*2,s=100+150*Math.random();this.particles.push({x:0,y:0,vx:Math.cos(t)*s,vy:Math.sin(t)*s,size:4+6*Math.random()})}}}},324(e,t,s){s.r(t),s.d(t,{Boss:()=>i.st,Bouncy:()=>c.b,Bullet:()=>i.Dv,Collider:()=>c.J,Damage:()=>r.cv,Enemy:()=>i.jK,Explosion:()=>h.W,FollowTarget:()=>a.J,Health:()=>r.Xk,Lifetime:()=>r.iR,Player:()=>i.ai,Position:()=>n.yX,PowerUp:()=>i.RP,Rotation:()=>n.pL,Shield:()=>l.e,Size:()=>n.or,Sprite:()=>o.k,Trail:()=>o.X,Turbo:()=>l.V,Velocity:()=>n.uB,Wander:()=>a.M});var n=s(984),r=s(986),i=s(83),o=s(922),a=s(768),c=s(821),l=s(356),h=s(266)},356(e,t,s){s.d(t,{V:()=>Turbo,e:()=>Shield});class Shield{constructor(e=2){this.maxPower=2,this.rechargeRate=.1,this.isActive=!1,this.current=Math.min(e,this.maxPower)}activate(){return this.current>0&&(this.isActive=!0,!0)}deactivate(){this.isActive=!1}drain(e){return!!this.isActive&&(this.current-=e,!(this.current<=0)||(this.current=0,this.isActive=!1,!1))}recharge(e){this.isActive||(this.current=Math.min(this.maxPower,this.current+this.rechargeRate*e))}getPercentage(){return this.current/this.maxPower}}class Turbo{constructor(e=2,t=1.5,s=.1){this.maxPower=e,this.speedMultiplier=t,this.rechargeRate=s,this.isActive=!1,this.current=e}activate(){return this.current>0&&(this.isActive=!0,!0)}deactivate(){this.isActive=!1}drain(e){return!!this.isActive&&(this.current=Math.max(0,this.current-e),!(this.current<=0)||(this.isActive=!1,!1))}recharge(e){this.isActive||(this.current=Math.min(this.maxPower,this.current+this.rechargeRate*e))}getPercentage(){return this.current/this.maxPower}}},768(e,t,s){s.d(t,{J:()=>FollowTarget,M:()=>Wander});class FollowTarget{constructor(e=0,t=0,s=50){this.targetX=e,this.targetY=t,this.speed=s}}class Wander{constructor(e=30,t=2){this.speed=e,this.changeInterval=t,this.direction=Math.random()*Math.PI*2,this.changeTimer=0}}},821(e,t,s){s.d(t,{J:()=>Collider,b:()=>Bouncy});class Collider{constructor(e=10,t="default"){this.radius=e,this.layer=t}}class Bouncy{constructor(e=1){this.bounciness=e}}},922(e,t,s){s.d(t,{X:()=>Trail,k:()=>Sprite});class Sprite{constructor(e="#ffffff",t="rect"){this.color=e,this.shape=t}}class Trail{constructor(e="#ffffff",t=10){this.color=e,this.maxLength=t,this.positions=[]}addPoint(e,t){this.positions.unshift({x:e,y:t,alpha:1}),this.positions.length>this.maxLength&&this.positions.pop();for(let e=0;e<this.positions.length;e++)this.positions[e].alpha=1-e/this.maxLength}}},984(e,t,s){s.d(t,{or:()=>Size,pL:()=>Rotation,uB:()=>Velocity,yX:()=>Position});class Position{constructor(e=0,t=0){this.x=e,this.y=t}}class Velocity{constructor(e=0,t=0){this.x=e,this.y=t}}class Size{constructor(e=10,t=10){this.width=e,this.height=t}}class Rotation{constructor(e=0){this.angle=e}}},986(e,t,s){s.d(t,{Xk:()=>Health,cv:()=>Damage,iR:()=>Lifetime});class Health{constructor(e=100,t=100){this.current=e,this.max=t}takeDamage(e){this.current=Math.max(0,this.current-e)}heal(e){this.current=Math.min(this.max,this.current+e)}isDead(){return this.current<=0}}class Damage{constructor(e=10){this.amount=e}}class Lifetime{constructor(e=1){this.remaining=e}}}},s={};function __webpack_require__(e){var n=s[e];if(void 0!==n)return n.exports;var r=s[e]={exports:{}};return t[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var s in t)__webpack_require__.o(t,s)&&!__webpack_require__.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(e){e.First="First",e.PreUpdate="PreUpdate",e.Update="Update",e.PostUpdate="PostUpdate",e.Last="Last"}(e||(e={}));const n=[e.First,e.PreUpdate,e.Update,e.PostUpdate,e.Last];class EntityAllocator{constructor(){this.nextId=0,this.freeList=[],this.meta=new Map,this.aliveCount=0}allocate(){let e,t;if(this.freeList.length>0){e=this.freeList.pop();const s=this.meta.get(e);t=s.generation,s.archetypeId=0,s.archetypeRow=0}else e=this.nextId++,t=0,this.meta.set(e,{generation:t,archetypeId:0,archetypeRow:0});return this.aliveCount++,{id:e,generation:t}}deallocate(e){const t=this.meta.get(e.id);return!!t&&(t.generation===e.generation&&(t.generation++,this.freeList.push(e.id),this.aliveCount--,!0))}isAlive(e){const t=this.meta.get(e.id);return!!t&&t.generation===e.generation}getMeta(e){const t=this.meta.get(e.id);if(t&&t.generation===e.generation)return t}setLocation(e,t,s){const n=this.meta.get(e.id);n&&n.generation===e.generation&&(n.archetypeId=t,n.archetypeRow=s)}getAllAlive(){const e=[];for(const[t,s]of this.meta.entries()){this.freeList.includes(t)||e.push({id:t,generation:s.generation})}return e}getCount(){return this.aliveCount}clear(){this.nextId=0,this.freeList=[],this.meta.clear(),this.aliveCount=0}reserve(e){}}class ComponentTicks{constructor(e){this.added=e,this.changed=e}setChanged(e){this.changed=e}isAdded(e,t){return this.wasChangedAfter(e,t)&&this.added>e}isChanged(e,t){return this.wasChangedAfter(e,t)}wasChangedAfter(e,t){return this.changed>e&&this.changed<=t}}var r,i,o,a,c;function matchesChangeFilter(e,t,s,n){switch(t){case r.None:return!0;case r.Added:return e.isAdded(s,n);case r.Changed:return e.isChanged(s,n)}}!function(e){e.None="None",e.Added="Added",e.Changed="Changed"}(r||(r={}));!function(e){e.Table="Table",e.SparseSet="SparseSet"}(i||(i={}));class ComponentInfo{constructor(e,t=i.Table){this.componentClass=e,this.name=e.name,this.storageType=t,this.id=e.name}}class ComponentStorage{constructor(e){this.storage=new Map,this.ticks=new Map,this.info=new ComponentInfo(e)}insert(e,t,s=0){this.storage.set(e,t),this.ticks.set(e,new ComponentTicks(s))}get(e){return this.storage.get(e)}getTicks(e){return this.ticks.get(e)}has(e){return this.storage.has(e)}remove(e){const t=this.storage.delete(e);return this.ticks.delete(e),t}entities(){return Array.from(this.storage.keys())}*iter(){for(const[e,t]of this.storage.entries())yield[e,t]}clear(){this.storage.clear(),this.ticks.clear()}len(){return this.storage.size}}class ComponentRegistry{constructor(){this.storages=new Map,this.infos=new Map,this.currentTick=0}register(e,t=i.Table){const s=e.name;if(!this.infos.has(s)){const n=new ComponentInfo(e,t);this.infos.set(s,n),this.storages.set(s,new ComponentStorage(e))}return this.infos.get(s)}getStorage(e){const t=e.name;return this.storages.has(t)||this.register(e),this.storages.get(t)}getInfo(e){return this.infos.get(e.name)}removeEntity(e){for(const t of this.storages.values())t.remove(e)}incrementTick(){this.currentTick++}getTick(){return this.currentTick}clear(){for(const e of this.storages.values())e.clear()}getRegisteredTypes(){return Array.from(this.infos.values()).map(e=>e.componentClass)}}class ResourceRegistry{constructor(){this.resources=new Map}insertInstance(e){const t=e.constructor.name;this.resources.set(t,e)}get(e){const t=e.name;return this.resources.get(t)}getRequired(e){const t=this.get(e);if(void 0===t)throw new Error(`Resource not found: ${e.name}`);return t}has(e){return this.resources.has(e.name)}remove(e){return this.resources.delete(e.name)}clear(){this.resources.clear()}count(){return this.resources.size}*iter(){for(const[e,t]of this.resources.entries())yield[e,t]}}!function(e){e.None="None",e.With="With",e.Without="Without",e.Added="Added",e.Changed="Changed"}(o||(o={}));class QueryState{constructor(e){this.filters=[],this.lastRun=0,this.componentClasses=e}addWith(e){this.filters.push({type:o.With,componentClass:e})}addWithout(e){this.filters.push({type:o.Without,componentClass:e})}addAdded(e){this.filters.push({type:o.Added,componentClass:e})}addChanged(e){this.filters.push({type:o.Changed,componentClass:e})}getFilters(){return this.filters}updateLastRun(e){this.lastRun=e}getLastRun(){return this.lastRun}}class Query{constructor(e,t,s){this.state=new QueryState(s),this.entityAllocator=e,this.componentRegistry=t}with(e){return this.state.addWith(e),this}without(e){return this.state.addWithout(e),this}added(e){return this.state.addAdded(e),this}changed(e){return this.state.addChanged(e),this}*iter(){const e=this.entityAllocator.getAllAlive(),t=this.componentRegistry.getTick(),s=this.state.getLastRun();for(const n of e)if(this.matchesEntity(n,t,s)){const e=this.fetchComponents(n);e&&(yield[n,...e])}this.state.updateLastRun(t)}single(){for(const e of this.iter())return e}toArray(){return Array.from(this.iter())}count(){let e=0;for(const t of this.iter())e++;return e}isEmpty(){for(const e of this.iter())return!1;return!0}matchesEntity(e,t,s){for(const t of this.state.componentClasses){if(!this.componentRegistry.getStorage(t).has(e.id))return!1}for(const n of this.state.getFilters())if(!this.matchesFilter(e,n,t,s))return!1;return!0}matchesFilter(e,t,s,n){if(!t.componentClass)return!0;const i=this.componentRegistry.getStorage(t.componentClass);switch(t.type){case o.None:return!0;case o.With:return i.has(e.id);case o.Without:return!i.has(e.id);case o.Added:{const t=i.getTicks(e.id);return!!t&&matchesChangeFilter(t,r.Added,n,s)}case o.Changed:{const t=i.getTicks(e.id);return!!t&&matchesChangeFilter(t,r.Changed,n,s)}default:return!0}}fetchComponents(e){const t=[];for(const s of this.state.componentClasses){const n=this.componentRegistry.getStorage(s).get(e.id);if(void 0===n)return;t.push(n)}return t}getState(){return this.state}}!function(e){e.SpawnEntity="SpawnEntity",e.DespawnEntity="DespawnEntity",e.InsertComponent="InsertComponent",e.RemoveComponent="RemoveComponent",e.InsertResource="InsertResource",e.RemoveResource="RemoveResource"}(a||(a={}));class EntityCommands{constructor(e){this.commands=e,this.components=[]}insert(e){return this.components.push(e),this}onSpawn(e){return this.callback=e,this}_build(){return{components:this.components,callback:this.callback}}}class Commands{constructor(){this.queue=[],this.pendingSpawns=[]}spawn(){const e=new EntityCommands(this);return this.pendingSpawns.push(e),e}despawn(e){this.queue.push({type:a.DespawnEntity,entity:e})}insertComponent(e,t){this.queue.push({type:a.InsertComponent,entity:e,component:t})}removeComponent(e,t){this.queue.push({type:a.RemoveComponent,entity:e,componentClass:t})}insertResource(e){this.queue.push({type:a.InsertResource,resource:e})}removeResource(e){this.queue.push({type:a.RemoveResource,resourceClass:e})}_finalizePendingSpawns(){for(const e of this.pendingSpawns){const{components:t,callback:s}=e._build();this.queue.push({type:a.SpawnEntity,components:t,callback:s})}this.pendingSpawns=[]}_drain(){this._finalizePendingSpawns();const e=this.queue;return this.queue=[],e}hasPending(){return this.queue.length>0||this.pendingSpawns.length>0}}class World{constructor(){this.entityAllocator=new EntityAllocator,this.componentRegistry=new ComponentRegistry,this.resourceRegistry=new ResourceRegistry,this.commands=new Commands}spawn(){const e=this.entityAllocator.allocate();return new EntityBuilder(this,e)}despawn(e){const t=this.entityAllocator.deallocate(e);return t&&this.componentRegistry.removeEntity(e.id),t}isAlive(e){return this.entityAllocator.isAlive(e)}entities(){return this.entityAllocator.getAllAlive()}entityCount(){return this.entityAllocator.getCount()}insertComponent(e,t){const s=t.constructor;this.componentRegistry.getStorage(s).insert(e.id,t)}getComponent(e,t){return this.componentRegistry.getStorage(t).get(e.id)}hasComponent(e,t){return this.componentRegistry.getStorage(t).has(e.id)}removeComponent(e,t){return this.componentRegistry.getStorage(t).remove(e.id)}insertResource(e){this.resourceRegistry.insertInstance(e)}getResource(e){return this.resourceRegistry.get(e)}getResourceRequired(e){return this.resourceRegistry.getRequired(e)}hasResource(e){return this.resourceRegistry.has(e)}removeResource(e){return this.resourceRegistry.remove(e)}query(...e){return new Query(this.entityAllocator,this.componentRegistry,e)}getCommands(){return this.commands}applyCommands(){const e=this.commands._drain();for(const t of e)this.applyCommand(t)}applyCommand(e){switch(e.type){case a.SpawnEntity:{const t=this.entityAllocator.allocate();for(const s of e.components)this.insertComponent(t,s);e.callback&&e.callback(t);break}case a.DespawnEntity:this.despawn(e.entity);break;case a.InsertComponent:this.isAlive(e.entity)&&this.insertComponent(e.entity,e.component);break;case a.RemoveComponent:this.isAlive(e.entity)&&this.removeComponent(e.entity,e.componentClass);break;case a.InsertResource:this.insertResource(e.resource);break;case a.RemoveResource:this.removeResource(e.resourceClass)}}clear(){this.entityAllocator.clear(),this.componentRegistry.clear(),this.resourceRegistry.clear(),this.commands._drain()}}class EntityBuilder{constructor(e,t){this.world=e,this.entity=t}insert(e){return this.world.insertComponent(this.entity,e),this}id(){return this.entity}}class SystemDescriptor{constructor(t){this.config={fn:t,stage:e.Update,enabled:!0}}label(e){return this.config.label=e,this}inStage(e){return this.config.stage=e,this}runIf(e){return this.config.runCriteria=e,this}before(e){return this.config.before=this.config.before||[],this.config.before.push(e),this}after(e){return this.config.after=this.config.after||[],this.config.after.push(e),this}setEnabled(e){return this.config.enabled=e,this}build(){return{...this.config}}}class Schedule{constructor(){this.stages=new Map,this.labeledSystems=new Map;for(const e of n)this.stages.set(e,[])}addSystem(e){const t=e.build(),s=t.stage;return this.stages.get(s).push(t),t.label&&this.labeledSystems.set(t.label,t),this}addSystemFn(e){return this.addSystem(new SystemDescriptor(e))}run(e){for(const t of n)this.runStage(t,e)}runStage(e,t){const s=this.stages.get(e),n=this.sortSystems(s);for(const e of n)this.runSystem(e,t);t.applyCommands()}runSystem(e,t){if(!!e.enabled){if(e.runCriteria){if(!e.runCriteria(t))return}e.fn(t)}}sortSystems(e){const t=[],s=[...e],n=new Set;for(;s.length>0;){let e=!1;for(let r=0;r<s.length;r++){const i=s[r];if(this.canRunNow(i,n)){t.push(i),n.add(i),s.splice(r,1),e=!0;break}}if(!e){t.push(...s);break}}return t}canRunNow(e,t){if(!e.after||0===e.after.length)return!0;for(const s of e.after){const e=this.labeledSystems.get(s);if(e&&!t.has(e))return!1}return!0}systemCount(){let e=0;for(const t of this.stages.values())e+=t.length;return e}clear(){for(const e of n)this.stages.set(e,[]);this.labeledSystems.clear()}}function system(e){return new SystemDescriptor(e)}class App{constructor(){this.startupSystems=[],this.startupComplete=!1,this.running=!1,this.rafId=null,this.lastTime=0,this.frameCount=0,this.frameCallbacks=[],this.world=new World,this.schedule=new Schedule}addPlugin(e){return e.build(this),this}addPlugins(e){for(const t of e)this.addPlugin(t);return this}addStartupSystem(e){return this.startupSystems.push(e),this}addSystem(e){return"function"==typeof e?this.schedule.addSystemFn(e):this.schedule.addSystem(e),this}addSystems(e){for(const t of e)this.addSystem(t);return this}insertResource(e){return this.world.insertResource(e),this}getWorld(){return this.world}getSchedule(){return this.schedule}onFrame(e){return this.frameCallbacks.push(e),this}runStartup(){if(!this.startupComplete){for(const e of this.startupSystems)e(this.world);this.world.applyCommands(),this.startupComplete=!0}}runFrame(e){const t=0===this.lastTime?16.67:e-this.lastTime;this.lastTime=e;const s=this.world.getResource(Time);s&&(s.delta=t/1e3,s.elapsed+=s.delta,s.frameCount++);for(const e of this.frameCallbacks)e(t);this.schedule.run(this.world),this.frameCount++,this.running&&(this.rafId=requestAnimationFrame(e=>this.runFrame(e)))}run(){return this.world.hasResource(Time)||this.world.insertResource(new Time),this.runStartup(),this.running=!0,this.lastTime=0,this.rafId=requestAnimationFrame(e=>this.runFrame(e)),this}stop(){this.running=!1,null!==this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}reset(){this.stop(),this.world.clear(),this.startupComplete=!1,this.frameCount=0,this.lastTime=0,this.world.insertResource(new Time),this.runStartup(),this.running=!0,this.rafId=requestAnimationFrame(e=>this.runFrame(e))}update(){this.startupComplete||this.runStartup(),this.schedule.run(this.world)}}class Time{constructor(){this.delta=0,this.elapsed=0,this.frameCount=0}deltaSeconds(){return this.delta}elapsedSeconds(){return this.elapsed}}class Events{constructor(){this.current=[],this.previous=[],this.nextId=0,this.currentTick=0}send(e){const t=this.nextId++;return this.current.push({id:t,event:e,tick:this.currentTick}),t}sendBatch(e){for(const t of e)this.send(t)}*iter(){for(const e of this.previous)yield e.event}*iterWithId(){for(const e of this.previous)yield[e.id,e.event]}drain(){return this.previous.map(e=>e.event)}isEmpty(){return 0===this.previous.length}len(){return this.previous.length}clear(){this.current=[],this.previous=[]}update(e){this.currentTick=e,this.previous=this.current,this.current=[]}getCurrentEvents(){return this.current.map(e=>e.event)}}!function(e){e.OnAdd="OnAdd",e.OnChange="OnChange",e.OnRemove="OnRemove"}(c||(c={}));class Observer{constructor(e){this.componentClass=e.componentClass,this.trigger=e.trigger,this.callback=e.callback,this.label=e.label,this.priority=e.priority??0}execute(e,t){this.callback(e,t)}}class observer_ObserverRegistry{constructor(){this.observers=new Map}getKey(e,t){return`${e.name}:${t}`}register(e){const t=new Observer(e),s=this.getKey(e.componentClass,e.trigger);this.observers.has(s)||this.observers.set(s,[]);const n=this.observers.get(s);return n.push(t),n.sort((e,t)=>t.priority-e.priority),t}trigger(e,t,s,n){const r=this.getKey(s,e),i=this.observers.get(r);if(i)for(const e of i)e.execute(t,n)}getObservers(e,t){const s=this.getKey(e,t);return this.observers.get(s)||[]}clear(){this.observers.clear()}clearFor(e,t){const s=this.getKey(e,t);this.observers.delete(s)}count(){let e=0;for(const t of this.observers.values())e+=t.length;return e}}class ObserverBuilder{constructor(e,t){this.descriptor={componentClass:e,trigger:t}}run(e){return this.descriptor.callback=e,this}label(e){return this.descriptor.label=e,this}priority(e){return this.descriptor.priority=e,this}build(){if(!this.descriptor.callback)throw new Error("Observer must have a callback function");return this.descriptor}}function onAdd(e){return new ObserverBuilder(e,c.OnAdd)}function onChange(e){return new ObserverBuilder(e,c.OnChange)}function onRemove(e){return new ObserverBuilder(e,c.OnRemove)}class Input{constructor(){this.pressed=new Set,this.justPressed=new Set,this.justReleased=new Set,window.addEventListener("keydown",e=>this.onKeyDown(e)),window.addEventListener("keyup",e=>this.onKeyUp(e))}onKeyDown(e){const t=e.key.toLowerCase();!this.pressed.has(t)&&this.justPressed.add(t),this.pressed.add(t)}onKeyUp(e){const t=e.key.toLowerCase();this.pressed.delete(t),this.justReleased.add(t)}isPressed(e){return this.pressed.has(e.toLowerCase())}isJustPressed(e){return this.justPressed.has(e.toLowerCase())}isJustReleased(e){return this.justReleased.has(e.toLowerCase())}clear(){this.justPressed.clear(),this.justReleased.clear()}}class resources_GameConfig{constructor(e=800,t=500,s=200,n=100,r=2,i=10){this.canvasWidth=e,this.canvasHeight=t,this.playerSpeed=s,this.bulletSpeed=n,this.enemySpawnInterval=r,this.maxEnemies=i}}class GameState{constructor(){this.score=0,this.enemiesKilled=0,this.powerUpsCollected=0,this.bossesKilled=0,this.isGameOver=!1,this.isPaused=!1,this.enemyDamageMultiplier=1,this.difficultyLevel=0,this.difficultyTimer=0,this.baseMaxEnemies=10}addScore(e){this.score+=e}recordEnemyKill(){this.enemiesKilled++,this.enemyDamageMultiplier=1+.01*Math.floor(this.enemiesKilled/10)}getScaledDamage(e){return Math.round(e*this.enemyDamageMultiplier)}updateDifficulty(e){return!this.isGameOver&&(this.difficultyTimer+=e,this.difficultyTimer>=30&&(this.difficultyTimer-=30,this.difficultyLevel++,!0))}getMaxEnemies(){return this.baseMaxEnemies+this.difficultyLevel}reset(){this.score=0,this.enemiesKilled=0,this.powerUpsCollected=0,this.bossesKilled=0,this.isGameOver=!1,this.isPaused=!1,this.enemyDamageMultiplier=1,this.difficultyLevel=0,this.difficultyTimer=0}}class CanvasContext{constructor(e){const t=e.getContext("2d");if(!t)throw new Error("Failed to get 2D context");this.ctx=t}clear(e="#0a0a0f"){this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}}class resources_Logger{constructor(){this.maxEntries=50,this.entries=[],this.logElement=null,this.logElement=document.getElementById("log")}log(e,t="info"){this.entries.unshift({message:e,type:t}),this.entries.length>this.maxEntries&&this.entries.pop(),this.updateDisplay()}system(e){this.log(e,"system")}entity(e){this.log(e,"entity")}component(e){this.log(e,"component")}updateDisplay(){this.logElement&&(this.logElement.innerHTML=this.entries.slice(0,20).map(e=>`<div class="log-entry ${e.type}">${e.message}</div>`).join(""))}}class SpawnTimer{constructor(e=2){this.interval=e,this.timer=0}tick(e){this.timer+=e;return!!(this.timer>=this.interval)&&(this.timer=0,!0)}}class ShootCooldown{constructor(e=.2){this.cooldown=e,this.timer=0}tick(e){this.timer>0&&(this.timer-=e)}canShoot(){return this.timer<=0}shoot(){this.timer=this.cooldown}}class BossSpawnTimer{constructor(e=15){this.interval=e,this.timer=0}tick(e){this.timer+=e;return!!(this.timer>=this.interval)&&(this.timer=0,!0)}reset(){this.timer=0}}class EntitySpawnedEvent{constructor(e,t){this.entity=e,this.entityType=t}}class BulletHitEvent{constructor(e,t,s,n){this.bullet=e,this.enemy=t,this.damage=s,this.position=n}}class PlayerHitEvent{constructor(e,t,s){this.enemy=e,this.damage=t,this.playerHealthRemaining=s}}class ScoreChangedEvent{constructor(e,t,s){this.points=e,this.newTotal=t,this.reason=s}}class GameOverEvent{constructor(e,t,s,n){this.finalScore=e,this.enemiesKilled=t,this.powerUpsCollected=s,this.survivalTime=n}}class GameStartEvent{constructor(e=!1){this.isRestart=e}}class PlayerShootEvent{constructor(e){this.position=e}}class BossSpawnedEvent{constructor(e,t){this.boss=e,this.health=t}}class GameEvents{constructor(){this.entitySpawned=new Events,this.entityDespawned=new Events,this.collision=new Events,this.bulletHit=new Events,this.playerHit=new Events,this.powerUpCollected=new Events,this.damage=new Events,this.entityKilled=new Events,this.scoreChanged=new Events,this.gameOver=new Events,this.gameStart=new Events,this.playerShoot=new Events,this.playerHealthChanged=new Events,this.bossSpawned=new Events,this.bossKilled=new Events}updateAll(e){this.entitySpawned.update(e),this.entityDespawned.update(e),this.collision.update(e),this.bulletHit.update(e),this.playerHit.update(e),this.powerUpCollected.update(e),this.damage.update(e),this.entityKilled.update(e),this.scoreChanged.update(e),this.gameOver.update(e),this.gameStart.update(e),this.playerShoot.update(e),this.playerHealthChanged.update(e),this.bossSpawned.update(e),this.bossKilled.update(e)}clearAll(){this.entitySpawned.clear(),this.entityDespawned.clear(),this.collision.clear(),this.bulletHit.clear(),this.playerHit.clear(),this.powerUpCollected.clear(),this.damage.clear(),this.entityKilled.clear(),this.scoreChanged.clear(),this.gameOver.clear(),this.gameStart.clear(),this.playerShoot.clear(),this.playerHealthChanged.clear(),this.bossSpawned.clear(),this.bossKilled.clear()}}var l=__webpack_require__(984),h=__webpack_require__(83),u=__webpack_require__(356),d=__webpack_require__(922),g=__webpack_require__(986),m=__webpack_require__(821);var y=__webpack_require__(266);function isBombAvailable(e,t){const s=e.current>=e.maxPower,n=t.current>=t.maxPower;return s&&n}function getBombRadii(){return{inner:100,outer:150}}var p=__webpack_require__(768);function checkCollision(e,t,s,n){const r=e.x-s.x,i=e.y-s.y;return Math.sqrt(r*r+i*i)<t.radius+n.radius}const f=system(function inputClearSystem(e){const t=e.getResource(Input);t&&t.clear()}).label("input_clear").inStage(e.Last),w=system(function playerInputSystem(e){const t=e.getResource(Input),s=e.getResource(resources_GameConfig),n=e.getResource(Time),r=e.getResource(GameState);if(!t||!s||!n)return;if(r?.isGameOver)return;const i=e.query(l.yX,l.uB,l.pL,h.ai).single();if(!i)return;const[,o,a,c]=i;a.x=0,a.y=0;const d=t.isPressed("arrowleft")||t.isPressed("a"),g=t.isPressed("arrowright")||t.isPressed("d");d&&(c.angle-=4*n.delta),g&&(c.angle+=4*n.delta);const m=Math.cos(c.angle),y=Math.sin(c.angle),p=t.isPressed("arrowup")||t.isPressed("w"),f=t.isPressed("arrowdown")||t.isPressed("s");p&&(a.x=m*s.playerSpeed,a.y=y*s.playerSpeed),f&&(a.x=-m*s.playerSpeed,a.y=-y*s.playerSpeed);const w=e.query(u.V,h.ai).single();if(w){const e=w[1];e.isActive&&(a.x*=e.speedMultiplier,a.y*=e.speedMultiplier)}const v=e.query(l.or,h.ai).single();if(v){const e=v[1].width/2,t=v[1].height/2;o.x=Math.max(e,Math.min(s.canvasWidth-e,o.x)),o.y=Math.max(t,Math.min(s.canvasHeight-t,o.y))}}).label("player_input").inStage(e.PreUpdate),v=system(function playerShootSystem(e){const t=e.getResource(Input),s=e.getResource(resources_GameConfig),n=e.getResource(Time),r=e.getResource(ShootCooldown),i=e.getResource(resources_Logger),o=e.getResource(GameState);if(!(t&&s&&n&&r))return;if(o?.isGameOver)return;r.tick(n.delta);const a=t.isPressed(" "),c=r.canShoot();if(!(a&&c))return;const u=e.query(l.yX,l.uB,l.pL,h.ai).single();if(!u)return;const[,y,p,f]=u,w=Math.cos(f.angle),v=Math.sin(f.angle),S=y.x+25*w,b=y.y+25*v,R=p.x*w+p.y*v,C=Math.max(0,R),E=s.bulletSpeed+C,x=w*E,_=v*E;e.getCommands().spawn().insert(new l.yX(S,b)).insert(new l.uB(x,_)).insert(new l.or(16,16)).insert(new d.k("#ffff00","circle")).insert(new d.X("#ffff00",12)).insert(new h.Dv).insert(new g.cv(25)).insert(new m.J(15,"bullet")).insert(new g.iR(2)),r.shoot(),i&&i.system("Bullet spawned")}).label("player_shoot").inStage(e.PreUpdate).after("player_input"),S=system(function shieldSystem(e){const t=e.getResource(Input),s=e.getResource(Time),n=e.getResource(resources_Logger),r=e.getResource(GameState);if(!t||!s)return;if(r?.isGameOver)return;const i=e.query(l.yX,u.e,h.ai).single();if(!i)return;const[,,o]=i;if(t.isPressed("y")){if(!o.isActive){o.activate()&&n&&n.system("üõ°Ô∏è Shield activated!")}if(o.isActive){!o.drain(s.delta)&&n&&n.system("üõ°Ô∏è Shield depleted!")}}else o.isActive&&(o.deactivate(),n&&n.system("üõ°Ô∏è Shield deactivated, recharging...")),o.recharge(s.delta)}).label("shield").inStage(e.PreUpdate).after("player_input"),b=system(function turboSystem(e){const t=e.getResource(Input),s=e.getResource(Time),n=e.getResource(resources_Logger),r=e.getResource(GameState);if(!t||!s)return;if(r?.isGameOver)return;const i=e.query(l.yX,u.V,h.ai).single();if(!i)return;const[,,o]=i;if(t.isPressed("t")){if(!o.isActive){o.activate()&&n&&n.system("üöÄ Turbo activated!")}if(o.isActive){!o.drain(s.delta)&&n&&n.system("üöÄ Turbo depleted!")}}else o.isActive&&(o.deactivate(),n&&n.system("üöÄ Turbo deactivated, recharging...")),o.recharge(s.delta)}).label("turbo").inStage(e.PreUpdate).after("player_input"),R=system(function bombSystem(e){const t=e.getResource(Input),s=e.getResource(Time),n=e.getResource(resources_Logger),r=e.getResource(GameState),i=e.getCommands();if(!t||!s)return;if(r?.isGameOver)return;const o=e.query(l.yX,u.e,u.V,h.ai).single();if(!o)return;const[a,c,d,m]=o;if(t.isJustPressed("b")){if(!isBombAvailable(d,m))return void(n&&n.system("üí£ Bomb not ready! Need full Shield and Turbo."));d.current=0,d.isActive=!1,m.current=0,m.isActive=!1,n&&n.system("üí£ BOMB DETONATED! Shield and Turbo depleted."),i.spawn().insert(new l.yX(c.x,c.y)).insert(new y.W(150,.5,"#ff8800")),i.spawn().insert(new l.yX(c.x,c.y)).insert(new y.W(100,.5,"#ffff00"));const t=e.query(l.yX,g.Xk,h.jK);for(const[e,s,o]of t.iter()){const t=s.x-c.x,a=s.y-c.y,h=Math.sqrt(t*t+a*a);if(h<=100)o.current=0,i.spawn().insert(new l.yX(s.x,s.y)).insert(new y.W(50,.4,"#ff4466")),i.despawn(e),r&&(r.addScore(100),r.recordEnemyKill()),n&&n.component("üí• Enemy destroyed by bomb (inner zone)");else if(h<=150){const t=.5*o.max;o.current<=t?(o.current=0,i.spawn().insert(new l.yX(s.x,s.y)).insert(new y.W(40,.4,"#ff6644")),i.despawn(e),r&&(r.addScore(100),r.recordEnemyKill()),n&&n.component("üí• Enemy destroyed by bomb (outer zone, low health)")):(o.takeDamage(t),n&&n.component("üí• Enemy damaged by bomb (outer zone, -50% HP)"))}}}}).label("bomb").inStage(e.PreUpdate).after("player_input"),C=system(function wanderSystem(e){const t=e.getResource(Time),s=e.getResource(resources_GameConfig);if(!t||!s)return;const n=e.query(l.yX,l.uB,p.M);for(const[,e,r,i]of n.iter()){i.changeTimer+=t.delta;i.changeTimer>=i.changeInterval&&(i.direction=Math.random()*Math.PI*2,i.changeTimer=0),r.x=Math.cos(i.direction)*i.speed,r.y=Math.sin(i.direction)*i.speed;const n=20;e.x<-n&&(e.x=s.canvasWidth+n),e.x>s.canvasWidth+n&&(e.x=-n),e.y<-n&&(e.y=s.canvasHeight+n),e.y>s.canvasHeight+n&&(e.y=-n)}}).label("wander").inStage(e.Update),E=system(function followTargetSystem(e){if(!e.getResource(Time))return;const t=e.query(l.yX,h.ai).single();if(!t)return;const[,s]=t,n=e.query(l.yX,l.uB,p.J);for(const[,e,t,r]of n.iter()){r.targetX=s.x,r.targetY=s.y;const n=r.targetX-e.x,i=r.targetY-e.y,o=Math.sqrt(n*n+i*i);o<5?(t.x=0,t.y=0):(t.x=n/o*r.speed,t.y=i/o*r.speed)}}).label("follow_target").inStage(e.Update),x=system(function movementSystem(e){const t=e.getResource(Time);if(!t)return;const s=e.query(l.yX,l.uB);for(const[,e,n]of s.iter())e.x+=n.x*t.delta,e.y+=n.y*t.delta}).label("movement").inStage(e.Update).after("wander").after("follow_target"),_=system(function bounceSystem(e){const t=e.getResource(resources_GameConfig);if(!t)return;const s=e.query(l.yX,l.uB,l.or,m.b);for(const[,e,n,r]of s.iter()){const s=r.width/2,i=r.height/2,o=e.x-s<0,a=e.x+s>t.canvasWidth;(o||a)&&(n.x*=-1,e.x=o?s:t.canvasWidth-s);const c=e.y-i<0,l=e.y+i>t.canvasHeight;(c||l)&&(n.y*=-1,e.y=c?i:t.canvasHeight-i)}}).label("bounce").inStage(e.Update).after("movement"),P=system(function trailSystem(e){const t=e.query(l.yX,d.X);for(const[,e,s]of t.iter())s.addPoint(e.x,e.y)}).label("trail").inStage(e.Update).after("movement"),k=system(function lifetimeSystem(e){const t=e.getResource(Time),s=e.getResource(resources_GameConfig),n=e.getResource(resources_Logger);if(!t)return;const r=e.query(g.iR),i=e.getCommands();for(const[o,a]of r.iter()){a.remaining-=t.delta;if(a.remaining<=0){if(void 0!==e.getComponent(o,h.RP)&&s){const t=e.getComponent(o,l.yX);t&&(t.x=Math.random()*(s.canvasWidth-60)+30,t.y=Math.random()*(s.canvasHeight-60)+30,a.remaining=15,n&&n.entity("‚≠ê Power-up relocated to new position"))}else i.despawn(o)}}}).label("lifetime").inStage(e.PostUpdate),A=system(function explosionSystem(e){const t=e.getResource(Time);if(!t)return;const s=e.query(l.yX,y.W),n=e.getCommands();for(const[e,r,i]of s.iter()){i.elapsed+=t.delta;const s=i.elapsed/i.duration;i.currentRadius=i.maxRadius*Math.sin(s*Math.PI);for(const e of i.particles)e.x+=e.vx*t.delta,e.y+=e.vy*t.delta,e.vx*=.95,e.vy*=.95;i.elapsed>=i.duration&&n.despawn(e)}}).label("explosion").inStage(e.PostUpdate),M=(system(function bulletEnemyCollisionSystem(e){const t=e.getResource(GameState),s=e.getResource(resources_Logger),n=e.getCommands(),r=e.query(l.yX,m.J,g.cv,h.Dv),i=e.query(l.yX,m.J,g.Xk,h.jK),o=r.toArray(),a=i.toArray();o.length>0&&a.length>0&&console.log(`Collision check: ${o.length} bullets vs ${a.length} enemies`);for(const[e,r,i,c]of o)for(const[o,l,h,u]of a){const a=r.x-l.x,d=r.y-l.y,g=Math.sqrt(a*a+d*d),m=i.radius+h.radius;g<100&&console.log(`Close! dist=${g.toFixed(1)} needed<${m}`);if(!(g<m))continue;s&&s.entity(`üí• HIT! Distance: ${g.toFixed(1)} < ${m}`),u.takeDamage(c.amount),n.despawn(e);u.isDead()&&(n.despawn(o),t&&(t.addScore(100),t.recordEnemyKill()),s&&s.entity("Enemy destroyed! +100 points"));break}}).label("bullet_enemy_collision").inStage(e.PostUpdate),system(function playerEnemyCollisionSystem(e){const t=e.getResource(GameState),s=e.getResource(resources_GameConfig),n=e.getResource(resources_Logger),r=e.getCommands();if(t?.isGameOver)return;const i=e.query(l.yX,m.J,g.Xk,h.ai),o=e.query(l.yX,m.J,h.jK),a=i.single();if(!a)return;const[c,p,f,w]=a,v=e.query(u.e,h.ai).single(),S=v?v[1]:null,b=!0===S?.isActive;for(const[,e,i]of o.iter()){if(!checkCollision(p,f,e,i))continue;if(b){n&&n.component("üõ°Ô∏è Shield blocked enemy attack!");continue}const o=10,a=t?t.getScaledDamage(o):o;if(w.takeDamage(a),n&&n.component(`Player hit! Health: ${w.current}`),s){const e=Math.random()*(s.canvasWidth-80)+40,t=Math.random()*(s.canvasHeight-80)+40;r.spawn().insert(new l.yX(e,t)).insert(new l.uB(0,0)).insert(new l.or(20,20)).insert(new d.k("#00d9ff","circle")).insert(new h.RP).insert(new g.Xk(25,25)).insert(new m.J(12,"powerup")).insert(new g.iR(15)),n&&n.entity("‚≠ê Power-up spawned to help player!")}w.isDead()&&t&&(t.isGameOver=!0,r.spawn().insert(new l.yX(p.x,p.y)).insert(new y.W(120,1,"#00ff88")),r.despawn(c),n&&n.system("üí• GAME OVER! Press Reset to play again."));break}}).label("player_enemy_collision").inStage(e.PostUpdate),system(function playerPowerUpCollisionSystem(e){const t=e.getResource(GameState),s=e.getResource(resources_Logger),n=e.getCommands(),r=e.query(l.yX,m.J,g.Xk,h.ai),i=e.query(l.yX,m.J,h.RP),o=r.single();if(!o)return;const[,a,c,u]=o;for(const[e,r,o]of i.iter()){checkCollision(a,c,r,o)&&(u.heal(25),n.despawn(e),t&&(t.addScore(50),t.powerUpsCollected++),s&&s.entity("Power-up collected! +25 HP, +50 points"))}}).label("player_powerup_collision").inStage(e.PostUpdate),system(function difficultyProgressionSystem(e){const t=e.getResource(Time),s=e.getResource(GameState),n=e.getResource(resources_Logger);if(!t||!s)return;if(s.isGameOver)return;if(s.updateDifficulty(t.delta)&&n){const e=s.getMaxEnemies();n.system(`‚ö†Ô∏è Difficulty increased! Max enemies: ${e}`)}}).label("difficulty_progression").inStage(e.Update)),T=system(function enemySpawnSystem(e){const t=e.getResource(Time),s=e.getResource(resources_GameConfig),n=e.getResource(SpawnTimer),r=e.getResource(GameState),i=e.getResource(resources_Logger);if(!(t&&s&&n&&r))return;if(r.isGameOver)return;if(e.query(h.jK).count()>=r.getMaxEnemies())return;if(!n.tick(t.delta))return;let o,a;switch(Math.floor(4*Math.random())){case 0:o=Math.random()*s.canvasWidth,a=-20;break;case 1:o=s.canvasWidth+20,a=Math.random()*s.canvasHeight;break;case 2:o=Math.random()*s.canvasWidth,a=s.canvasHeight+20;break;default:o=-20,a=Math.random()*s.canvasHeight}const c=Math.random(),u=e.getCommands();c<.5?u.spawn().insert(new l.yX(o,a)).insert(new l.uB(0,0)).insert(new l.or(24,24)).insert(new d.k("#ff6b6b","rect")).insert(new h.jK).insert(new g.Xk(50,50)).insert(new m.J(12,"enemy")).insert(new p.M(40+40*Math.random(),1+2*Math.random())).insert(new m.b):u.spawn().insert(new l.yX(o,a)).insert(new l.uB(0,0)).insert(new l.or(20,20)).insert(new d.k("#ff4444","circle")).insert(new h.jK).insert(new g.Xk(30,30)).insert(new m.J(10,"enemy")).insert(new p.J(0,0,50+30*Math.random())),i&&i.system("Enemy spawned")}).label("enemy_spawn").inStage(e.PostUpdate),B=system(function powerUpAutoSpawnSystem(e){const t=e.getResource(resources_GameConfig),s=e.getResource(GameState),n=e.getResource(resources_Logger);if(!t||s?.isGameOver)return;const r=e.query(l.yX,g.Xk,h.ai).single();if(!r)return;const[,,i]=r;if(!(i.current<i.max))return;if(e.query(l.yX,h.RP).count()>0)return;const o=Math.random()*(t.canvasWidth-60)+30,a=Math.random()*(t.canvasHeight-60)+30;e.getCommands().spawn().insert(new l.yX(o,a)).insert(new l.uB(0,0)).insert(new l.or(20,20)).insert(new d.k("#00d9ff","circle")).insert(new h.RP).insert(new g.Xk(25,25)).insert(new m.J(12,"powerup")).insert(new g.iR(15)),n&&n.entity("Power-up spawned (player needs healing)")}).label("powerup_auto_spawn").inStage(e.PostUpdate),O=system(function renderSystem(e){const t=e.getResource(CanvasContext);if(!t)return;const{ctx:s}=t;t.clear(),s.strokeStyle="#1a1a2e",s.lineWidth=1;for(let e=0;e<s.canvas.width;e+=40)s.beginPath(),s.moveTo(e,0),s.lineTo(e,s.canvas.height),s.stroke();for(let e=0;e<s.canvas.height;e+=40)s.beginPath(),s.moveTo(0,e),s.lineTo(s.canvas.width,e),s.stroke();const n=e.query(d.X);for(const[,e]of n.iter())for(const t of e.positions)s.globalAlpha=.5*t.alpha,s.fillStyle=e.color,s.beginPath(),s.arc(t.x,t.y,3,0,2*Math.PI),s.fill();s.globalAlpha=1;const r=e.query(l.yX,l.or,d.k);for(const[t,n,i,o]of r.iter()){s.fillStyle=o.color;const r=e.getComponent(t,l.pL),a=void 0!==r;if(a&&"spaceship"===o.shape){s.save(),s.translate(n.x,n.y),s.rotate(r.angle+Math.PI/2);const t=i.width,o=i.height;s.fillStyle="#ff3333",s.beginPath(),s.moveTo(0,.6*-o),s.lineTo(.25*t,.1*-o),s.lineTo(.2*t,.4*o),s.lineTo(.2*-t,.4*o),s.lineTo(.25*-t,.1*-o),s.closePath(),s.fill(),s.fillStyle="#cc2222",s.beginPath(),s.moveTo(.25*-t,.1*-o),s.lineTo(.5*-t,.3*o),s.lineTo(.4*-t,.5*o),s.lineTo(.2*-t,.4*o),s.closePath(),s.fill(),s.beginPath(),s.moveTo(.25*t,.1*-o),s.lineTo(.5*t,.3*o),s.lineTo(.4*t,.5*o),s.lineTo(.2*t,.4*o),s.closePath(),s.fill(),s.fillStyle="#ffffff",s.beginPath(),s.moveTo(0,.45*-o),s.lineTo(.1*t,.15*-o),s.lineTo(.1*-t,.15*-o),s.closePath(),s.fill(),s.fillStyle="#ffaa00",s.beginPath(),s.arc(0,.35*o,.12*t,0,2*Math.PI),s.fill(),s.fillStyle="#ff3333",s.beginPath(),s.arc(.45*-t,.4*o,.08*t,0,2*Math.PI),s.fill(),s.beginPath(),s.arc(.45*t,.4*o,.08*t,0,2*Math.PI),s.fill(),s.restore();const a=e.query(u.e,h.ai).single();if(a){if(a[1].isActive){const e=.8*Math.max(t,o);s.save(),s.strokeStyle="#00d9ff",s.lineWidth=3,s.globalAlpha=.6+.2*Math.sin(Date.now()/100),s.beginPath(),s.arc(n.x,n.y,e,0,2*Math.PI),s.stroke(),s.strokeStyle="#00ffff",s.lineWidth=1,s.globalAlpha=.3,s.beginPath(),s.arc(n.x,n.y,e-5,0,2*Math.PI),s.stroke(),s.restore()}}const c=e.query(u.V,h.ai).single();if(a&&c){if(isBombAvailable(a[1],c[1])){const{inner:e,outer:t}=getBombRadii();s.save(),s.strokeStyle="#ff6600",s.lineWidth=2,s.globalAlpha=.4+.15*Math.sin(Date.now()/200),s.setLineDash([10,5]),s.beginPath(),s.arc(n.x,n.y,t,0,2*Math.PI),s.stroke(),s.strokeStyle="#ffff00",s.lineWidth=2,s.globalAlpha=.5+.2*Math.sin(Date.now()/150),s.setLineDash([8,4]),s.beginPath(),s.arc(n.x,n.y,e,0,2*Math.PI),s.stroke(),s.setLineDash([]),s.fillStyle="#ffff00",s.font='10px "JetBrains Mono", monospace',s.textAlign="center",s.globalAlpha=.8,s.fillText("BOMB READY [B]",n.x,n.y-.8*o-30),s.restore()}}}else if(a&&"triangle"===o.shape)s.save(),s.translate(n.x,n.y),s.rotate(r.angle+Math.PI/2),s.beginPath(),s.moveTo(0,-i.height/2),s.lineTo(-i.width/2,i.height/2),s.lineTo(i.width/2,i.height/2),s.closePath(),s.fill(),s.restore();else switch(o.shape){case"rect":s.fillRect(n.x-i.width/2,n.y-i.height/2,i.width,i.height);break;case"circle":s.beginPath(),s.arc(n.x,n.y,i.width/2,0,2*Math.PI),s.fill();break;case"triangle":s.beginPath(),s.moveTo(n.x,n.y-i.height/2),s.lineTo(n.x-i.width/2,n.y+i.height/2),s.lineTo(n.x+i.width/2,n.y+i.height/2),s.closePath(),s.fill()}}const i=e.query(l.yX,l.or,g.Xk);for(const[,e,t,n]of i.iter()){const r=n.current/n.max,i=t.width,o=4,a=e.y-t.height/2-8;s.fillStyle="#333",s.fillRect(e.x-i/2,a,i,o);const c=r>.5?"#00ff88":r>.25?"#ffdd00":"#ff4444";s.fillStyle=c,s.fillRect(e.x-i/2,a,i*r,o)}const o=e.query(l.yX,l.or,u.e,h.ai).single();if(o){const[,e,t,n]=o,r=n.getPercentage(),i=t.width,a=4,c=e.y-t.height/2-14;s.fillStyle="#1a1a2e",s.fillRect(e.x-i/2,c,i,a);const l=n.isActive?"#00ffff":"#00a0d9";s.fillStyle=l,s.fillRect(e.x-i/2,c,i*r,a),n.isActive&&(s.strokeStyle="#00ffff",s.lineWidth=1,s.strokeRect(e.x-i/2-1,c-1,i+2,a+2))}const a=e.query(l.yX,l.or,u.V,h.ai).single();if(a){const[,e,t,n]=a,r=n.getPercentage(),i=t.width,o=4,c=e.y-t.height/2-20;s.fillStyle="#1a1a2e",s.fillRect(e.x-i/2,c,i,o);const l=n.isActive?"#ff6600":"#cc4400";s.fillStyle=l,s.fillRect(e.x-i/2,c,i*r,o),n.isActive&&(s.strokeStyle="#ff6600",s.lineWidth=1,s.strokeRect(e.x-i/2-1,c-1,i+2,o+2))}const c=e.query(l.yX,y.W);for(const[,e,t]of c.iter()){const n=t.elapsed/t.duration,r=1-n;s.strokeStyle=t.color,s.lineWidth=4,s.globalAlpha=r,s.beginPath(),s.arc(e.x,e.y,t.currentRadius,0,2*Math.PI),s.stroke(),s.fillStyle=t.color,s.globalAlpha=.3*r,s.beginPath(),s.arc(e.x,e.y,.7*t.currentRadius,0,2*Math.PI),s.fill(),s.globalAlpha=r;for(const r of t.particles)s.fillStyle=t.color,s.beginPath(),s.arc(e.x+r.x,e.y+r.y,r.size*(1-n),0,2*Math.PI),s.fill()}s.globalAlpha=1;const m=e.getResource(GameState);m?.isGameOver&&(s.fillStyle="rgba(0, 0, 0, 0.7)",s.fillRect(0,0,s.canvas.width,s.canvas.height),s.fillStyle="#ff4444",s.font='bold 48px "JetBrains Mono", monospace',s.textAlign="center",s.textBaseline="middle",s.fillText("GAME OVER",s.canvas.width/2,s.canvas.height/2-40),s.fillStyle="#00d9ff",s.font='24px "JetBrains Mono", monospace',s.fillText(`Final Score: ${m.score}`,s.canvas.width/2,s.canvas.height/2+20),s.fillStyle="#a1a1aa",s.font='16px "JetBrains Mono", monospace',s.fillText('Click "Reset Game" to play again',s.canvas.width/2,s.canvas.height/2+60))}).label("render").inStage(e.Last),I=system(function uiUpdateSystem(e){const t=e.getResource(GameState),s=e.getResource(Time),n=document.getElementById("entity-count");n&&(n.textContent=e.entityCount().toString());const r=document.getElementById("fps");if(r&&s){const e=s.elapsed>0?Math.round(s.frameCount/s.elapsed):60;r.textContent=e.toString()}const i=document.getElementById("system-count");i&&(i.textContent="15");const o=document.getElementById("score");o&&t&&(o.textContent=t.score.toString());const a=e.query(u.e,h.ai).single();if(a){const e=a[1],t=Math.round(100*e.getPercentage()),s=document.getElementById("shield-bar"),n=document.getElementById("shield-percent");s&&(s.style.width=`${t}%`,e.isActive?s.style.background="linear-gradient(90deg, #00ffff, #ffffff)":s.style.background="linear-gradient(90deg, #00d9ff, #00ffff)"),n&&(n.textContent=`${t}%`)}const c=e.query(u.V,h.ai).single();if(c){const e=c[1],t=Math.round(100*e.getPercentage()),s=document.getElementById("turbo-bar"),n=document.getElementById("turbo-percent");s&&(s.style.width=`${t}%`,e.isActive?s.style.background="linear-gradient(90deg, #ff6600, #ffaa00)":s.style.background="linear-gradient(90deg, #cc4400, #ff6600)"),n&&(n.textContent=`${t}%`)}if(a&&c){const e=isBombAvailable(a[1],c[1]),t=document.getElementById("bomb-indicator"),s=document.getElementById("bomb-status");t&&s&&(e?(t.style.border="1px solid #ffff00",t.style.background="rgba(255, 255, 0, 0.1)",s.textContent="READY!",s.style.color="#ffff00",s.style.background="#553300"):(t.style.border="1px dashed #555",t.style.background="rgba(0, 0, 0, 0.3)",s.textContent="NOT READY",s.style.color="#888",s.style.background="#333"))}}).label("ui_update").inStage(e.Last);class PlayerBundle{constructor(e=400,t=300,s=100){this.x=e,this.y=t,this.health=s}components(){return[new l.yX(this.x,this.y),new l.uB(0,0),new l.or(40,45),new l.pL(-Math.PI/2),new d.k("#ff3333","spaceship"),new h.ai,new g.Xk(this.health,this.health),new m.J(18,"player"),new u.e(2),new u.V(2)]}}class EnemyBundle{constructor(e=0,t=0,s=50,n=20){this.x=e,this.y=t,this.health=s,this.damage=n}components(){return[new l.yX(this.x,this.y),new l.uB(0,0),new l.or(25,25),new d.k("#ff4466","rect"),new h.jK,new g.Xk(this.health,this.health),new g.cv(this.damage),new m.J(12,"enemy"),new m.b(1)]}}class WanderingEnemyBundle{constructor(e=0,t=0){this.x=e,this.y=t}components(){return[...new EnemyBundle(this.x,this.y,50,20).components(),new p.M(40,2),new d.X("#ff4466",8)]}}class ChasingEnemyBundle{constructor(e=0,t=0,s=400,n=300){this.x=e,this.y=t,this.targetX=s,this.targetY=n}components(){return[...new EnemyBundle(this.x,this.y,75,30).components(),new p.J(this.targetX,this.targetY,60),new d.X("#ff6688",10)]}}class PowerUpBundle{constructor(e=0,t=0,s=25){this.x=e,this.y=t,this.healAmount=s}components(){return[new l.yX(this.x,this.y),new l.uB(0,0),new l.or(20,20),new d.k("#00d9ff","circle"),new h.RP,new g.Xk(this.healAmount,this.healAmount),new m.J(12,"powerup"),new g.iR(15)]}}class BossBundle{constructor(e=400,t=100){this.x=e,this.y=t}components(){return[new l.yX(this.x,this.y),new l.uB(0,0),new l.or(60,60),new d.k("#ff00ff","rect"),new h.jK,new h.st,new g.Xk(300,300),new g.cv(50),new m.J(30,"boss"),new p.J(400,300,40),new d.X("#ff00ff",15),new m.b(1)]}}function setupObservers(e,t,s,n){e.register(onAdd(h.ai).label("log_player_spawn").priority(100).run(e=>{t&&t.entity(`üéÆ Player spawned (ID: ${e.id})`),n&&n.entitySpawned.send(new EntitySpawnedEvent(e,"player"))}).build()),e.register(onAdd(h.jK).label("log_enemy_spawn").priority(100).run(e=>{t&&t.entity(`üëæ Enemy spawned (ID: ${e.id})`),n&&n.entitySpawned.send(new EntitySpawnedEvent(e,"enemy"))}).build()),e.register(onAdd(h.Dv).label("log_bullet_spawn").priority(100).run(e=>{t&&t.entity(`üí• Bullet fired (ID: ${e.id})`),n&&n.entitySpawned.send(new EntitySpawnedEvent(e,"bullet"))}).build()),e.register(onAdd(h.RP).label("log_powerup_spawn").priority(100).run(e=>{t&&t.entity(`‚≠ê Power-up spawned (ID: ${e.id})`),n&&n.entitySpawned.send(new EntitySpawnedEvent(e,"powerup"))}).build()),e.register(onAdd(h.st).label("log_boss_spawn").priority(100).run(e=>{t&&(t.system(`üëπ BOSS SPAWNED! (ID: ${e.id})`),t.system("‚ö†Ô∏è WARNING: Boss has 300 HP and deals 50 damage!")),n&&n.bossSpawned.send(new BossSpawnedEvent(e,300))}).build()),e.register(onAdd(y.W).label("log_explosion_spawn").priority(100).run(e=>{t&&t.entity(`üí´ Explosion created (ID: ${e.id})`),n&&n.entitySpawned.send(new EntitySpawnedEvent(e,"explosion"))}).build()),e.register(onChange(g.Xk).label("check_health_death").priority(50).run((e,s)=>{s&&s.isDead()&&t&&t.component(`‚ò†Ô∏è Entity ${e.id} health reached 0`)}).build()),e.register(onRemove(h.ai).label("player_removed").priority(100).run(e=>{t&&t.entity(`üíÄ Player destroyed (ID: ${e.id})`),s&&(s.isGameOver=!0)}).build()),e.register(onRemove(h.jK).label("enemy_removed").priority(100).run(e=>{t&&t.entity(`üéØ Enemy destroyed (ID: ${e.id})`),s&&s.recordEnemyKill()}).build()),e.register(onRemove(h.RP).label("powerup_removed").priority(100).run(e=>{t&&t.entity(`‚ú® Power-up collected (ID: ${e.id})`),s&&s.powerUpsCollected++}).build()),e.register(onRemove(h.st).label("boss_removed").priority(100).run(e=>{t&&(t.system(`üèÜ BOSS DEFEATED! (ID: ${e.id})`),t.system("üí∞ +500 BONUS POINTS!")),s&&s.addScore(500)}).build()),e.register(onChange(l.yX).label("position_changed").priority(10).run((e,t)=>{}).build())}function triggerSpawnObserver(e,t,s,n){e.trigger(c.OnAdd,t,s,n)}function triggerDespawnObserver(e,t,s){e.trigger(c.OnRemove,t,s,void 0)}function triggerChangeObserver(e,t,s,n){e.trigger(c.OnChange,t,s,n)}function setupObserversSystem(e){const t=e.getResource(resources_Logger),s=e.getResource(GameState),n=e.getResource(GameEvents),r=e.getResource(observer_ObserverRegistry);r&&(setupObservers(r,t,s,n),t&&t.system("üì° Observers registered"))}function spawnPlayerSystem(e){const t=e.getResource(resources_GameConfig),s=e.getResource(resources_Logger),n=e.getResource(GameEvents),r=e.getResource(observer_ObserverRegistry);if(!t)return void console.error("GameConfig not found!");const i=new PlayerBundle(t.canvasWidth/2,t.canvasHeight/2,100),o=e.spawn();for(const e of i.components())o.insert(e);const a=o.id();r&&triggerSpawnObserver(r,a,h.ai,new h.ai),n&&(n.gameStart.send(new GameStartEvent(!1)),n.entitySpawned.send(new EntitySpawnedEvent(a,"player"))),s&&(s.system("üéÆ Game started with BUNDLE spawning!"),s.system("üì¶ PlayerBundle used for player entity"))}const X=system(function processEventsSystem(e){const t=e.getResource(GameEvents),s=e.getResource(GameState),n=e.getResource(resources_Logger);if(t){for(const e of t.bulletHit.iter())s&&s.addScore(10),n&&n.component(`üí• Bullet hit enemy for ${e.damage} damage`);for(const e of t.playerHit.iter())n&&n.component(`üî• Player took ${e.damage} damage, health: ${e.playerHealthRemaining}`);for(const e of t.gameOver.iter())n&&n.system(`‚ò†Ô∏è GAME OVER! Score: ${e.finalScore}`);for(const e of t.scoreChanged.iter())n&&n.component(`‚≠ê Score: +${e.points} (${e.reason})`)}}).label("process_events").inStage(e.PostUpdate);const G=system(function event_processing_updateEventsSystem(e){const t=e.getResource(GameEvents),s=e.getResource(Time);t&&s&&t.updateAll(s.frameCount)}).label("update_events").inStage(e.Last);const D=system(function detectHealthChangesSystem(e){e.getResource(GameEvents);const t=e.getResource(observer_ObserverRegistry),s=e.query(l.yX,g.Xk);for(const[e,n,r]of s.iter())r.isDead()&&t&&triggerChangeObserver(t,e,g.Xk,r)}).label("detect_health_changes").inStage(e.PostUpdate);const q=system(function collisionWithEventsSystem(e){const t=e.getResource(GameEvents),s=e.getResource(GameState),n=e.getResource(observer_ObserverRegistry),r=e.getCommands();if(!t||s?.isGameOver)return;const i=e.query(l.yX,m.J,g.cv,h.Dv),o=e.query(l.yX,m.J,g.Xk,h.jK),a=i.toArray(),c=o.toArray();for(const[e,i,o,u]of a)for(const[a,d,g,m]of c){const c=i.x-d.x,p=i.y-d.y;if(Math.sqrt(c*c+p*p)<o.radius+g.radius){m.current;m.takeDamage(u.amount),t.bulletHit.send(new BulletHitEvent(e,a,u.amount,{x:d.x,y:d.y})),r.despawn(e),m.isDead()&&(n&&triggerDespawnObserver(n,a,h.jK),t.scoreChanged.send(new ScoreChangedEvent(100,(s?.score||0)+100,"enemy_killed")),s&&(s.addScore(100),s.recordEnemyKill()),r.spawn().insert(new l.yX(d.x,d.y)).insert(new y.W(50,.5,"#ff4466")),r.despawn(a));break}}const p=e.query(l.yX,m.J,g.Xk,h.ai).single(),f=e.query(u.e,h.ai).single(),w=f?f[1]:null,v=!0===w?.isActive;if(p){const[i,o,a,u]=p;for(const[p,f,w,S,b]of c){const c=e.query(g.cv,h.jK).toArray().find(([e])=>e.id===p.id),S=o.x-f.x,b=o.y-f.y;if(Math.sqrt(S*S+b*b)<a.radius+w.radius){if(v)continue;const a=c?c[1].amount:20,w=s?s.getScaledDamage(a):a;u.takeDamage(w),t.playerHit.send(new PlayerHitEvent(p,w,u.current)),n&&triggerChangeObserver(n,i,g.Xk,u);const S=e.getResource(resources_GameConfig);if(S&&!u.isDead()){const e=Math.random()*(S.canvasWidth-80)+40,t=Math.random()*(S.canvasHeight-80)+40;r.spawn().insert(new l.yX(e,t)).insert(new l.uB(0,0)).insert(new l.or(20,20)).insert(new d.k("#00d9ff","circle")).insert(new h.RP).insert(new g.Xk(25,25)).insert(new m.J(12,"powerup")).insert(new g.iR(15))}u.isDead()&&(n&&triggerDespawnObserver(n,i,h.ai),t.gameOver.send(new GameOverEvent(s?.score||0,s?.enemiesKilled||0,s?.powerUpsCollected||0,0)),s&&(s.isGameOver=!0),r.spawn().insert(new l.yX(o.x,o.y)).insert(new y.W(80,.7,"#00ff88")),r.despawn(i)),n&&triggerDespawnObserver(n,p,h.jK),r.spawn().insert(new l.yX(f.x,f.y)).insert(new y.W(40,.4,"#ff4466")),r.despawn(p);break}}}const S=e.query(l.yX,m.J,g.Xk,h.RP).toArray();if(p){const[e,i,o,a]=p;for(const[c,l,u,d]of S){const m=i.x-l.x,y=i.y-l.y;if(Math.sqrt(m*m+y*y)<o.radius+u.radius){const i=d.current;a.current;a.heal(i),t.powerUpCollected.send({powerUp:c,healAmount:i,newHealth:a.current}),t.scoreChanged.send(new ScoreChangedEvent(50,(s?.score||0)+50,"powerup_collected")),s&&(s.addScore(50),s.powerUpsCollected++),n&&(triggerChangeObserver(n,e,g.Xk,a),triggerDespawnObserver(n,c,h.RP)),r.despawn(c)}}}}).label("collision_with_events").inStage(e.PostUpdate);function bossExists(e){return e.query(l.yX,h.st).count()>0}function spawnBossWithBundle(e){const t=e.getResource(resources_GameConfig),s=e.getResource(GameEvents),n=e.getResource(observer_ObserverRegistry),r=e.getResource(GameState);if(!t||r?.isGameOver)return;if(bossExists(e))return;const i=t.canvasWidth/2,o=new BossBundle(i,80),a=e.spawn();for(const e of o.components())a.insert(e);const c=a.id();n&&(triggerSpawnObserver(n,c,h.jK,new h.jK),triggerSpawnObserver(n,c,h.st,new h.st)),s&&(s.entitySpawned.send(new EntitySpawnedEvent(c,"enemy")),s.bossSpawned.send(new BossSpawnedEvent(c,300)))}const L=system(function bossSpawnSystem(e){const t=e.getResource(BossSpawnTimer),s=e.getResource(Time),n=e.getResource(GameState);t&&s&&!n?.isGameOver&&t.tick(s.delta)&&!bossExists(e)&&(spawnBossWithBundle(e),e.applyCommands())}).label("boss_spawn").inStage(e.PostUpdate);function setupButtonHandlers(e,t){const s=e.getWorld(),blurAfterClick=e=>{e.blur()},n=document.getElementById("btn-shoot");n&&n.addEventListener("click",e=>{const t=s.getResource(GameState);t?.isGameOver||(!function shootBulletWithBundle(e){const t=e.getResource(resources_GameConfig),s=e.getResource(GameEvents),n=e.getResource(observer_ObserverRegistry),r=e.getResource(GameState);if(!t||r?.isGameOver)return;const i=e.query(l.yX,l.uB,l.pL,h.ai).single();if(!i)return;const[,o,a,c]=i,u=Math.cos(c.angle),y=Math.sin(c.angle),p=o.x+25*u,f=o.y+25*y,w=a.x*u+a.y*y,v=Math.max(0,w),S=t.bulletSpeed+v,b=u*S,R=y*S,C=e.spawn();C.insert(new l.yX(p,f)).insert(new l.uB(b,R)).insert(new l.or(16,16)).insert(new d.k("#ffff00","circle")).insert(new h.Dv).insert(new g.cv(25)).insert(new m.J(15,"bullet")).insert(new g.iR(2)).insert(new d.X("#ffff00",12));const E=C.id();n&&triggerSpawnObserver(n,E,h.Dv,new h.Dv),s&&(s.playerShoot.send(new PlayerShootEvent({x:o.x,y:o.y})),s.entitySpawned.send(new EntitySpawnedEvent(E,"bullet")))}(s),s.applyCommands(),blurAfterClick(e.target))});const r=document.getElementById("btn-spawn-enemy");r&&r.addEventListener("click",e=>{!function spawnEnemyWithBundle(e){const t=e.getResource(resources_GameConfig),s=e.getResource(GameEvents),n=e.getResource(observer_ObserverRegistry);if(!t)return;const r=Math.random()*t.canvasWidth,i=100*Math.random(),o=Math.random()>.5,a=e.spawn();let c;if(o){const e=new ChasingEnemyBundle(r,i,t.canvasWidth/2,t.canvasHeight/2);for(const t of e.components())a.insert(t)}else{const e=new WanderingEnemyBundle(r,i);for(const t of e.components())a.insert(t)}c=a.id(),n&&triggerSpawnObserver(n,c,h.jK,new h.jK),s&&s.entitySpawned.send(new EntitySpawnedEvent(c,"enemy"))}(s),s.applyCommands(),blurAfterClick(e.target)});const i=document.getElementById("btn-spawn-powerup");i&&i.addEventListener("click",e=>{!function spawnPowerUpWithBundle(e){const t=e.getResource(resources_GameConfig),s=e.getResource(GameEvents),n=e.getResource(observer_ObserverRegistry);if(!t)return;const r=Math.random()*(t.canvasWidth-40)+20,i=Math.random()*(t.canvasHeight-40)+20,o=new PowerUpBundle(r,i,30),a=e.spawn();for(const e of o.components())a.insert(e);const c=a.id();n&&triggerSpawnObserver(n,c,h.RP,new h.RP),s&&s.entitySpawned.send(new EntitySpawnedEvent(c,"powerup"))}(s),s.applyCommands(),blurAfterClick(e.target)});const o=document.getElementById("btn-spawn-boss");o&&o.addEventListener("click",e=>{spawnBossWithBundle(s),s.applyCommands(),blurAfterClick(e.target)});const a=document.getElementById("btn-reset");a&&a.addEventListener("click",n=>{blurAfterClick(n.target),function resetGame(e,t,s){e.reset();const n=new resources_GameConfig(s.width,s.height),r=new GameState,i=new GameEvents,o=new observer_ObserverRegistry,a=new resources_Logger;t.insertResource(n),t.insertResource(r),t.insertResource(new Input),t.insertResource(new CanvasContext(s)),t.insertResource(a),t.insertResource(new SpawnTimer(2)),t.insertResource(new ShootCooldown(.15)),t.insertResource(new BossSpawnTimer(15)),t.insertResource(i),t.insertResource(o),setupObservers(o,a,r,i);const c=new PlayerBundle(n.canvasWidth/2,n.canvasHeight/2,100),l=t.spawn();for(const e of c.components())l.insert(e);const u=l.id();triggerSpawnObserver(o,u,h.ai,new h.ai),i.gameStart.send(new GameStartEvent(!0)),a&&a.system("üîÑ Game restarted with bundles!")}(e,s,t)})}function main(){console.log("üöÄ Starting ECS Game Demo - FULL FEATURE DEMONSTRATION"),console.log("Features: Bundles, Events, Observers, Hierarchy, Change Detection, Query Filters");const e=document.getElementById("game-canvas");if(!e)return void console.error("Canvas element not found!");e.width=800,e.height=500;const t=(new App).insertResource(new resources_GameConfig(e.width,e.height)).insertResource(new GameState).insertResource(new Input).insertResource(new CanvasContext(e)).insertResource(new resources_Logger).insertResource(new SpawnTimer(2)).insertResource(new ShootCooldown(.15)).insertResource(new BossSpawnTimer(15)).insertResource(new GameEvents).insertResource(new observer_ObserverRegistry).addStartupSystem(setupObserversSystem).addStartupSystem(spawnPlayerSystem).addSystem(w).addSystem(v).addSystem(S).addSystem(b).addSystem(R).addSystem(M).addSystem(C).addSystem(E).addSystem(x).addSystem(_).addSystem(P).addSystem(k).addSystem(A).addSystem(q).addSystem(X).addSystem(D).addSystem(T).addSystem(B).addSystem(L).addSystem(O).addSystem(I).addSystem(G).addSystem(f);setupButtonHandlers(t,e),t.run(),console.log("‚úÖ Game running with ALL ECS features!"),console.log(""),console.log("üì¶ BUNDLES: Player, Enemy, Bullet, PowerUp spawned with bundles"),console.log("üì° EVENTS: CollisionEvent, DamageEvent, ScoreEvent, etc."),console.log("üëÅÔ∏è OBSERVERS: OnAdd, OnRemove, OnChange for entity lifecycle"),console.log("üîç QUERY FILTERS: With/Without filters demonstrated"),console.log("‚è±Ô∏è CHANGE DETECTION: Health changes tracked"),console.log(""),console.log("Controls: WASD to move, SPACE to shoot")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",main):main()})();